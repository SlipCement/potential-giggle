<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sorting Algorithm Visualizer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #121212;
      color: white;
      text-align: center;
    }
    #controls {
      margin-bottom: 20px;
    }
    #bars {
      display: flex;
      align-items: flex-end;
      height: 400px;
      border: 1px solid #333;
      background: #1e1e1e;
      overflow: hidden;
    }
    .bar {
      background: #4caf50;
      margin: 0 1px;
      flex: 1;
    }
    button, input[type="range"] {
      margin: 5px;
      padding: 10px;
      font-size: 1em;
    }
    label {
      margin: 0 10px;
    }
  </style>
</head>
<body>
  <h1>Sorting Algorithm Visualizer</h1>
  <div id="controls">
    <label>Bars: <input type="range" min="10" max="500" value="100" id="barCount" /></label>
    <label>Speed: <input type="range" min="1" max="100" value="50" id="speedControl" /></label>
    <button onclick="startSort('bubble')">Bubble Sort</button>
    <button onclick="startSort('selection')">Selection Sort</button>
    <button onclick="startSort('insertion')">Insertion Sort</button>
    <button onclick="startSort('merge')">Merge Sort</button>
    <button onclick="startSort('quick')">Quick Sort</button>
    <button onclick="stopSort()">Stop</button>
    <button onclick="generateBars()">Restart</button>
    <button onclick="toggleSound()" id="soundToggle">Mute</button>
  </div>
  <div id="bars"></div>

  <script>
    const barContainer = document.getElementById("bars");
    const barCountSlider = document.getElementById("barCount");
    const speedSlider = document.getElementById("speedControl");
    const soundToggleBtn = document.getElementById("soundToggle");
    let bars = [];
    let sorting = false;
    let soundEnabled = true;

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playTone(value) {
      if (!soundEnabled) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.frequency.value = 100 + value * 5;
      osc.type = 'sine';
      gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.start();
      osc.stop(audioCtx.currentTime + 0.05);
    }

    function toggleSound() {
      soundEnabled = !soundEnabled;
      soundToggleBtn.textContent = soundEnabled ? "Mute" : "Unmute";
    }

    function generateBars() {
      const count = parseInt(barCountSlider.value);
      barContainer.innerHTML = "";
      bars = [];
      for (let i = 0; i < count; i++) {
        const height = Math.floor(Math.random() * 100) + 1;
        const bar = document.createElement("div");
        bar.classList.add("bar");
        bar.style.height = `${height * 3}px`;
        bar.style.width = `${100 / count}%`;
        bars.push({ element: bar, value: height });
        barContainer.appendChild(bar);
      }
    }

    async function startSort(type) {
      if (sorting) return;
      sorting = true;
      switch (type) {
        case "bubble":
          await bubbleSort(); break;
        case "selection":
          await selectionSort(); break;
        case "insertion":
          await insertionSort(); break;
        case "merge":
          await mergeSort(0, bars.length - 1); break;
        case "quick":
          await quickSort(0, bars.length - 1); break;
      }
      sorting = false;
    }

    function stopSort() {
      sorting = false;
    }

    function getDelay() {
      return 101 - parseInt(speedSlider.value);
    }

    async function swap(i, j) {
      let temp = bars[i].value;
      bars[i].value = bars[j].value;
      bars[j].value = temp;

      bars[i].element.style.height = `${bars[i].value * 3}px`;
      bars[j].element.style.height = `${bars[j].value * 3}px`;

      playTone(bars[i].value);
    }

    async function bubbleSort() {
      for (let i = 0; i < bars.length - 1; i++) {
        for (let j = 0; j < bars.length - i - 1; j++) {
          if (!sorting) return;
          if (bars[j].value > bars[j + 1].value) {
            await swap(j, j + 1);
            await delay(getDelay());
          }
        }
      }
    }

    async function selectionSort() {
      for (let i = 0; i < bars.length; i++) {
        let min = i;
        for (let j = i + 1; j < bars.length; j++) {
          if (!sorting) return;
          if (bars[j].value < bars[min].value) min = j;
        }
        if (min !== i) {
          await swap(i, min);
          await delay(getDelay());
        }
      }
    }

    async function insertionSort() {
      for (let i = 1; i < bars.length; i++) {
        let key = bars[i].value;
        let j = i - 1;
        while (j >= 0 && bars[j].value > key) {
          if (!sorting) return;
          bars[j + 1].value = bars[j].value;
          bars[j + 1].element.style.height = `${bars[j].value * 3}px`;
          playTone(bars[j].value);
          j--;
          await delay(getDelay());
        }
        bars[j + 1].value = key;
        bars[j + 1].element.style.height = `${key * 3}px`;
        playTone(key);
      }
    }

    async function mergeSort(start, end) {
      if (start >= end || !sorting) return;
      const mid = Math.floor((start + end) / 2);
      await mergeSort(start, mid);
      await mergeSort(mid + 1, end);

      let temp = [];
      let i = start, j = mid + 1;

      while (i <= mid && j <= end) {
        if (!sorting) return;
        if (bars[i].value < bars[j].value) {
          temp.push(bars[i++].value);
        } else {
          temp.push(bars[j++].value);
        }
      }

      while (i <= mid) temp.push(bars[i++].value);
      while (j <= end) temp.push(bars[j++].value);

      for (let k = start; k <= end; k++) {
        bars[k].value = temp[k - start];
        bars[k].element.style.height = `${bars[k].value * 3}px`;
        playTone(bars[k].value);
        await delay(getDelay());
      }
    }

    async function quickSort(start, end) {
      if (start >= end || !sorting) return;
      const pivotIndex = await partition(start, end);
      await quickSort(start, pivotIndex - 1);
      await quickSort(pivotIndex + 1, end);
    }

    async function partition(start, end) {
      let pivotValue = bars[end].value;
      let pivotIndex = start;
      for (let i = start; i < end; i++) {
        if (!sorting) return pivotIndex;
        if (bars[i].value < pivotValue) {
          await swap(i, pivotIndex);
          pivotIndex++;
          await delay(getDelay());
        }
      }
      await swap(pivotIndex, end);
      return pivotIndex;
    }

    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    barCountSlider.addEventListener("input", generateBars);
    generateBars();
  </script>
</body>
</html>
